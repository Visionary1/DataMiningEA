<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hello!</title>
<link rel="stylesheet" href="https://stackedit.io/res-min/themes/base.css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body><div class="container"><h1 id="data-mining-17s-team-project-2nd-scrum">Data Mining 17S Team Project 2nd Scrum</h1>

<hr>



<h3 id="group-5-forecasting-car-sales-in-norway">Group 5, Forecasting Car Sales in Norway</h3>



<h4 id="team-members"><i class="icon-users"></i> Team members</h4>

<table>
<thead>
<tr>
  <th>Name</th>
  <th>Student ID</th>
</tr>
</thead>
<tbody><tr>
  <td>KIM CHANSUP</td>
  <td>12216101</td>
</tr>
<tr>
  <td>Nicholas Sutanto</td>
  <td>12415147</td>
</tr>
<tr>
  <td>Emil Guliyev</td>
  <td>82416617</td>
</tr>
</tbody></table>




<h3 id="executive-summary">Executive summary</h3>

<p>We are going to use data set from Kaggle, <a href="https://www.kaggle.com/dmi3kno/newcarsalesnorway">New Car Sales in Norway (2007~2017 Jan)</a> to predict future(2017 Feb~) car sales in Norway.  The forecasting process will be done in pure R, especially by ARIMA, as professor suggested. But rather than starting a prediction right away, we are planning to test some other models besides ARIMA to analysis its validity. And so as to do this, we will first predict sales in 2016 by several models, and see which model gives the least errors compared to actual data. And then we will use that model to predict sales in 2017.</p>



<h3 id="problem-description-wip-work-in-progress">Problem Description -WIP (work in progress)</h3>

<p>As we have sales ​data for 10 years, we can predict the sales data for following months. For example, our sales data is only until January 2017, and it gives us opportunity to predict sales for February, March, May, and other months.</p>



<h3 id="data-description">Data Description</h3>

<p>Dataset includes monthly car sales in Norway from 2007 January to 2017 January. It has been collected by the Road Traffic Information Council (OFV) and can be accessed from Kaggle. We are using <strong>norway_new_car_sales_by_month.csv</strong>, all inputs are numberic. It has 121 rows and 17 columns, important input variables are Year, Month, and Quantity, others are not relevant in terms of sales prediction.</p>



<h3 id="utility-wip">Utility -WIP</h3>

<p>Based on results from our findings, car makers and investors will know the rough              estimate of sales should they continue to commit in this business. Having a sort of model or graphs done by calculation in data mining, all relevant stakeholders have another source to decide what they are going to do instead of relying to assumption and baseless arguments. </p>



<h3 id="preprocessing-of-data">Preprocessing of Data</h3>

<p>First, We load the R libraries that we need for this analysis.</p>



<pre class="prettyprint"><code class=" hljs erlang"><span class="hljs-function"><span class="hljs-title">library</span><span class="hljs-params">(forecast)</span>
<span class="hljs-title">library</span><span class="hljs-params">(dplyr)</span>
<span class="hljs-title">library</span><span class="hljs-params">(tseries)</span>
<span class="hljs-title">library</span><span class="hljs-params">(zoo)</span></span></code></pre>

<p>The <em>forecast</em> is for the functions we need for predicting time series data. The <em>dylyr</em> is for manipulating data frames.  The <em>tseries</em> is a package for handling time series data. And <em>zoo</em> is for the use of trans-forming a data(as.yearmon)</p>

<p>After installing dependencies, read the csv data</p>



<pre class="prettyprint"><code class=" hljs livecodeserver">dt&lt;-<span class="hljs-built_in">read</span>.csv(<span class="hljs-string">"...path/norway_new_car_sales_by_month.csv"</span>, header = <span class="hljs-constant">TRUE</span>, stringsAsFactors = <span class="hljs-constant">FALSE</span>)</code></pre>

<p>We can’t handle this data now, because it is too messy. If we plot the data, it’ll be shown like this</p>

<p><img src="http://i.imgur.com/kyNru6F.png" alt="enter image description here" title=""></p>

<p>It is because there are too many input variables(and some NAs). In order to make a clean, usable data(for our project), we will discard some variables that are irrelevant. Total quantity of sales by yearly, monthly, and type of car(electric, diesel, hybrid…etc) sales are the ones that we care about. Besides, we have to convert the data frame to ts(time series) for manipulation.</p>



<pre class="prettyprint"><code class=" hljs scss"><span class="hljs-tag">dt</span>&lt;<span class="hljs-function">-transform(dt, Yearmon = as.<span class="hljs-function">yearmon(<span class="hljs-function">paste(Year, Month, sep = <span class="hljs-string">"-"</span>)</span>)</span>)</span>
<span class="hljs-tag">dt</span>$Date&lt;-as<span class="hljs-class">.Date</span>(<span class="hljs-tag">dt</span>$Yearmon)

dt_ts&lt;<span class="hljs-function">-ts(dt$Quantity, frequency=<span class="hljs-number">12</span>, start=<span class="hljs-function">c(<span class="hljs-number">2007</span>,<span class="hljs-number">1</span>)</span>, end = <span class="hljs-function">c(<span class="hljs-number">2016</span>,<span class="hljs-number">12</span>)</span>)</span>
<span class="hljs-function">plot(dt_ts)</span></code></pre>

<p><img src="http://i.imgur.com/X03zFw7.png" alt="enter image description here" title=""></p>

<p>So now we have our time series data. The next step is modeling.</p>



<h4 id="choosing-a-model">Choosing a model</h4>

<p>We did mention that we would use several models to see how they predict sales in 2016. We will use the model that go close to the actual data for forecasting of 2017. As we are asked to use 3 different models(1 for 1st scrum, +2 for 2nd scrum), we will use the following models.</p>

<ol>
<li>Exponential State Smoothing(ETS)</li>
<li>TBATS  </li>
<li>ARIMA (did this in 1st scrum)</li>
</ol>



<h4 id="model-1-exponential-state-smoothingets">Model 1. Exponential State Smoothing(ETS)</h4>

<p>The ETS function is in *forecast’ package, and is used for making forecasts. Although it is best used in data that where past observations are weighted equally(simple moving average), we did give it a try.</p>



<pre class="prettyprint"><code class=" hljs scss">fitstl&lt;<span class="hljs-function">-stl(dt_ts, s.window = <span class="hljs-string">"period"</span>)</span>
m_ets&lt;<span class="hljs-function">-forecast(fitstl, method = <span class="hljs-string">"ets"</span>, h=<span class="hljs-number">12</span>)</span>
<span class="hljs-function">plot(m_ets)</span></code></pre>

<p><img src="http://i.imgur.com/7boHnMq.png" alt="enter image description here" title=""></p>

<p>By specifying <em>h=12</em>, we made a prediction for next 12 months. <br>
The gap between gray area and blue area(AKA confidence interval) seems big. We’ll compare this prediction with other models and with actual data later.</p>



<h4 id="model-2-tbats">Model 2. TBATS</h4>

<p>TBATS model is designed for forecasting and is best applied when the data has cyclic patterns.</p>



<pre class="prettyprint"><code class=" hljs fix"><span class="hljs-attribute">fut_tbats </span>=<span class="hljs-string"> forecast(tbats(dt_ts), h=12)
plot(fut_tbats)</span></code></pre>

<p><img src="http://i.imgur.com/v0k2F2P.png" alt="enter image description here" title=""></p>

<p>Prediction seems almost same as Model 1.</p>



<h4 id="model-3-arima">Model 3. ARIMA</h4>

<p>ARIMA is considered as the best function for predicting time series. <em>auto.arima()</em> automatically optimizes parameter and gives you the best model(within ARIMA). <br>
On 1st scrum, we wrote ARIMA manually, but turned out we could just use <em>auto.arima</em> on 2nd scrum.</p>

<p>1st scrum (legacy way)</p>



<pre class="prettyprint"><code class=" hljs lasso">library(tseries)

adf<span class="hljs-built_in">.</span>test(diff(<span class="hljs-keyword">log</span>(dt_ts)), alternative<span class="hljs-subst">=</span><span class="hljs-string">"stationary"</span>, k<span class="hljs-subst">=</span><span class="hljs-number">0</span>)
(fit <span class="hljs-subst">&lt;-</span> arima(<span class="hljs-keyword">log</span>(dt_ts), c(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),seasonal <span class="hljs-subst">=</span> <span class="hljs-built_in">list</span>(<span class="hljs-keyword">order</span> <span class="hljs-subst">=</span> c(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), period <span class="hljs-subst">=</span> <span class="hljs-number">12</span>)))
pred <span class="hljs-subst">&lt;-</span> predict(fit, n<span class="hljs-built_in">.</span>ahead <span class="hljs-subst">=</span> <span class="hljs-number">1</span><span class="hljs-subst">*</span><span class="hljs-number">12</span>)
ts<span class="hljs-built_in">.</span>plot(dt_ts,<span class="hljs-number">2.718</span>^pred<span class="hljs-variable">$pred</span>, <span class="hljs-keyword">log</span> <span class="hljs-subst">=</span> <span class="hljs-string">"y"</span>, lty <span class="hljs-subst">=</span> c(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>))</code></pre>

<p><img src="http://i.imgur.com/OF7MZGq.png" alt="enter image description here" title=""></p>

<p>2nd scrum (using <em>auto.arima</em>)</p>



<pre class="prettyprint"><code class=" hljs makefile"><span class="hljs-constant">aarima</span> = auto.arima(dt_ts)
<span class="hljs-constant">fut_aa</span> = forecast(aarima, h=12)
plot(fut_aa)</code></pre>

<p><img src="http://i.imgur.com/6ueggrm.png" alt="enter image description here" title=""></p>

<p>Both way produce a same result.</p>

<hr>



<h4 id="best-model">Best model ?</h4>

<p>Now, we will compare the actual data with predicted data. <br>
(data is from 2016 January to 2016 December)</p>

<table>
<thead>
<tr>
  <th>Actual</th>
  <th>ETS</th>
  <th>TBATS</th>
  <th>ARIMA</th>
</tr>
</thead>
<tbody><tr>
  <td>Jan 10991</td>
  <td>12330.43</td>
  <td>12234.69</td>
  <td>12480.50</td>
</tr>
<tr>
  <td>Feb 12222</td>
  <td>12107.88</td>
  <td>12164.86</td>
  <td>12549.69</td>
</tr>
<tr>
  <td>Mar 13875</td>
  <td>13666.77</td>
  <td>13647.09</td>
  <td>13303.97</td>
</tr>
<tr>
  <td>Apr 14116</td>
  <td>13131.34</td>
  <td>13467.60</td>
  <td>13005.00</td>
</tr>
<tr>
  <td>May 12864</td>
  <td>13312.24</td>
  <td>13011.46</td>
  <td>12843.02</td>
</tr>
<tr>
  <td>Jun 13681</td>
  <td>12849.02</td>
  <td>12735.90</td>
  <td>13314.40</td>
</tr>
<tr>
  <td>Jul 11040</td>
  <td>13241.80</td>
  <td>13171.97</td>
  <td>12920.75</td>
</tr>
<tr>
  <td>Aug 13232</td>
  <td>12661.62</td>
  <td>12876.17</td>
  <td>12966.35</td>
</tr>
<tr>
  <td>Sep 13854</td>
  <td>12820.76</td>
  <td>12754.44</td>
  <td>12926.61</td>
</tr>
<tr>
  <td>Oct 11932</td>
  <td>13506.48</td>
  <td>13634.88</td>
  <td>13095.10</td>
</tr>
<tr>
  <td>Nov 13194</td>
  <td>12980.64</td>
  <td>12641.90</td>
  <td>12965.48</td>
</tr>
<tr>
  <td>Dec 13055</td>
  <td>12514.44</td>
  <td>12582.13</td>
  <td>13069.26</td>
</tr>
</tbody></table>


<p>But because sales(number of car sold) can’t be decimal values, we will round up these numbers to remove trailings.</p>

<table>
<thead>
<tr>
  <th>Actual</th>
  <th>ETS</th>
  <th>TBATS</th>
  <th>ARIMA</th>
</tr>
</thead>
<tbody><tr>
  <td>Jan 10991</td>
  <td>12330</td>
  <td>12235</td>
  <td>12481</td>
</tr>
<tr>
  <td>Feb 12222</td>
  <td>12108</td>
  <td>12165</td>
  <td>12550</td>
</tr>
<tr>
  <td>Mar 13875</td>
  <td>13667</td>
  <td>13647</td>
  <td>13304</td>
</tr>
<tr>
  <td>Apr 14116</td>
  <td>13131</td>
  <td>13468</td>
  <td>13005</td>
</tr>
<tr>
  <td>May 12864</td>
  <td>13312</td>
  <td>13012</td>
  <td>12843</td>
</tr>
<tr>
  <td>Jun 13681</td>
  <td>12849</td>
  <td>12736</td>
  <td>13314</td>
</tr>
<tr>
  <td>Jul 11040</td>
  <td>13242</td>
  <td>13172</td>
  <td>12921</td>
</tr>
<tr>
  <td>Aug 13232</td>
  <td>12662</td>
  <td>12876</td>
  <td>12966</td>
</tr>
<tr>
  <td>Sep 13854</td>
  <td>12821</td>
  <td>12754</td>
  <td>12927</td>
</tr>
<tr>
  <td>Oct 11932</td>
  <td>13507</td>
  <td>13635</td>
  <td>13095</td>
</tr>
<tr>
  <td>Nov 13194</td>
  <td>12981</td>
  <td>12642</td>
  <td>12966</td>
</tr>
<tr>
  <td>Dec 13055</td>
  <td>12514</td>
  <td>12582</td>
  <td>13069</td>
</tr>
<tr>
  <td>total 154056</td>
  <td>155124</td>
  <td>154924</td>
  <td>155441</td>
</tr>
</tbody></table>


<p>and let’s visualize these in R…</p>



<pre class="prettyprint"><code class=" hljs scss">actual &lt;- <span class="hljs-function">c(<span class="hljs-number">10991</span>, <span class="hljs-number">12222</span>, <span class="hljs-number">13875</span>, <span class="hljs-number">14116</span>, <span class="hljs-number">12864</span>, <span class="hljs-number">13681</span>, <span class="hljs-number">11040</span>, <span class="hljs-number">13232</span>, <span class="hljs-number">13854</span>, <span class="hljs-number">11932</span>, <span class="hljs-number">13194</span>, <span class="hljs-number">13055</span>)</span>
p_ets &lt;- <span class="hljs-function">c(<span class="hljs-number">12330</span>, <span class="hljs-number">12108</span>, <span class="hljs-number">13667</span>, <span class="hljs-number">13131</span>, <span class="hljs-number">13312</span>, <span class="hljs-number">12849</span>, <span class="hljs-number">13242</span>, <span class="hljs-number">12662</span>, <span class="hljs-number">12821</span>, <span class="hljs-number">13507</span>, <span class="hljs-number">12981</span>, <span class="hljs-number">12514</span>)</span>
p_tbats &lt;- <span class="hljs-function">c(<span class="hljs-number">12235</span>, <span class="hljs-number">12165</span>, <span class="hljs-number">13647</span>, <span class="hljs-number">13468</span>, <span class="hljs-number">13012</span>, <span class="hljs-number">12736</span>, <span class="hljs-number">13172</span>, <span class="hljs-number">12876</span>, <span class="hljs-number">12754</span>, <span class="hljs-number">13635</span>, <span class="hljs-number">12642</span>, <span class="hljs-number">12582</span>)</span>
p_arima &lt;- <span class="hljs-function">c(<span class="hljs-number">12481</span>, <span class="hljs-number">12550</span>, <span class="hljs-number">13304</span>, <span class="hljs-number">13005</span>, <span class="hljs-number">12843</span>, <span class="hljs-number">13314</span>, <span class="hljs-number">12921</span>, <span class="hljs-number">12966</span>, <span class="hljs-number">12927</span>, <span class="hljs-number">13095</span>, <span class="hljs-number">12966</span>, <span class="hljs-number">13069</span>)</span>

<span class="hljs-function">library(ggfortify)</span>
<span class="hljs-function">autoplot(<span class="hljs-function">ts(<span class="hljs-function">cbind(p_ets, p_tbats, p_arima, actual)</span>, start = <span class="hljs-function">c(<span class="hljs-number">2016</span>,<span class="hljs-number">1</span>)</span>, end = <span class="hljs-function">c(<span class="hljs-number">2016</span>, <span class="hljs-number">12</span>)</span>, frequency = <span class="hljs-number">12</span>)</span>,facets = FALSE)</span></code></pre>

<p><img src="http://i.imgur.com/aLY8JVS.png" alt="enter image description here" title=""></p>

<p>The actual data has a sharp (could be considered as seasonal trend ?) decline, in January, July and October. And because our forecasting models did not predict that, it is hard to choose a best model. So we have decided to compare yearly(by total sales) rather than monthly. Total sales of 2016 did not show big difference than our predictions.</p>

<p>total sales were as follow</p>

<table>
<thead>
<tr>
  <th>Actual</th>
  <th>ETS</th>
  <th>TBATS</th>
  <th>ARIMA</th>
</tr>
</thead>
<tbody><tr>
  <td>154056</td>
  <td>155124</td>
  <td>154924</td>
  <td>155441</td>
</tr>
<tr>
  <td>-</td>
  <td>-1068</td>
  <td>-868</td>
  <td>-1385</td>
</tr>
</tbody></table>


<p>and because TBATS model showed the least error, we will use TBATS to predict car sales in 2017.</p>



<pre class="prettyprint"><code class=" hljs erlang">dt_ts&lt;-ts(dt$<span class="hljs-variable">Quantity</span>, frequency=<span class="hljs-number">12</span>, start=c(<span class="hljs-number">2007</span>,<span class="hljs-number">1</span>))

<span class="hljs-function"><span class="hljs-title">library</span><span class="hljs-params">(forecast)</span>
<span class="hljs-title">fut_tbats</span> = <span class="hljs-title">forecast</span><span class="hljs-params">(<span class="hljs-function_name">tbats</span>(dt_ts), h=<span class="hljs-number">11</span>)</span>
<span class="hljs-title">plot</span><span class="hljs-params">(fut_tbats)</span></span></code></pre>

<p>We removed end parameter when assigning a new time series data. So <em>dt_ts</em> should look like this</p>

<p><img src="http://i.imgur.com/8o3ueHW.png" alt="enter image description here" title=""></p>

<p>Because our data has its record until 2017 January, we only have to predict 11 remaining months for 2017 (Feb~Dec). So we changed <em>h = 11</em> in forecast().</p>

<p>Following picture is the prediction of car sales in 2017 by TBATS model.</p>

<p><img src="http://i.imgur.com/5duqgqO.png" alt="enter image description here" title=""></p>

<p>and this is the summary of TBATS prediction.</p>



<pre class="prettyprint"><code class=" hljs erlang"><span class="hljs-function"><span class="hljs-title">summary</span><span class="hljs-params">(fut_tbats)</span></span></code></pre>

<p><img src="http://i.imgur.com/4K0Q9uw.png" alt="enter image description here" title=""></p>



<h4 id="conclusion">Conclusion</h4>

<p>The forecast car sales in 2017 would be 163428. (Actual January sales 13055 + predicted sales from Feb~Dec 150373)</p>



<h1 id="professor-wants">professor wants…</h1>

<ol>
<li><del>2 more models</del> this is done</li>
<li>correlations between variables with a discussion of the results</li>
<li><del>3 more graphs</del> this is done i think?</li>
<li>a deeper discussion of how the results can be used</li>
</ol></div></body>
</html>
